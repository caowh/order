<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd" >
<mapper namespace="cwh.order.producer.dao.FoodDao">

    <insert id="insert" parameterType="cwh.order.producer.model.Food">
      INSERT INTO FOOD(f_name,description,price,classify_id,picture_url) VALUES (#{f_name},#{description},#{price},#{classify_id},#{picture_url});
    </insert>

    <select id="queryByClassify" parameterType="cwh.order.producer.util.PageQuery" resultType="cwh.order.producer.model.Food">
        SELECT f.id,f.f_name,f.description,f.price,f.status,f.picture_url,fc.classify_name
        FROM FOOD f JOIN FOOD_CLASSIFY fc ON fc.id = f.classify_id WHERE
        <foreach collection="longList" open="(" close=")" separator="OR" item="id">
            fc.id = #{id,jdbcType=BIGINT}
        </foreach>
        AND fc.openid = #{string_param}
        <if test="int_param != 2">
            AND f.status = #{int_param}
        </if>
        ORDER BY f.id DESC limit #{start},#{count};
    </select>

    <select id="queryAll" parameterType="cwh.order.producer.util.PageQuery" resultType="cwh.order.producer.model.Food">
        SELECT f.id,f.f_name,f.description,f.price,f.status,f.picture_url,fc.classify_name
        FROM FOOD f JOIN FOOD_CLASSIFY fc ON fc.id = f.classify_id WHERE fc.openid = #{string_param}
        <if test="int_param != 2">
            AND f.status = #{int_param}
        </if>
        ORDER BY f.id DESC limit #{start},#{count};
    </select>

    <select id="queryExistName" parameterType="java.util.Map" resultType="java.lang.Integer">
        SELECT count(0) FROM FOOD f JOIN FOOD_CLASSIFY fc ON fc.id = f.classify_id WHERE fc.openid=#{openid} AND f.f_name=#{name}
    </select>

    <select id="queryCountByClassify" parameterType="java.lang.Long" resultType="java.lang.Integer">
        SELECT count(0) FROM FOOD WHERE classify_id=#{classify_id};
    </select>

    <update id="updateStatus" parameterType="cwh.order.producer.model.Food">
        UPDATE FOOD SET status = #{status} WHERE id = #{id}
    </update>

    <select id="queryExistId" parameterType="cwh.order.producer.model.Food" resultType="java.lang.Integer">
        SELECT count(0) FROM FOOD f JOIN FOOD_CLASSIFY fc ON fc.id = f.classify_id WHERE f.id=#{id} AND fc.openid = #{openid}
    </select>
</mapper>